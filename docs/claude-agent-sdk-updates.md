# Claude Agent SDK æ›´æ–°æ€»ç»“

## æ¦‚è¿°

æ ¹æ® `create.js` æ–‡ä»¶çš„æ¨¡å¼ï¼Œæˆ‘å·²ç»æ›´æ–°äº†é¡¹ç›®ä¸­æ‰€æœ‰æ¶‰åŠ claude-agent-sdk çš„æ–‡ä»¶ï¼Œæ”¹è¿›äº†ç¯å¢ƒå˜é‡åŠ è½½ã€è¿›åº¦ä¿¡æ¯å¤„ç†å’Œä¼šè¯ç®¡ç†ã€‚

## ä¸»è¦æ›´æ”¹

### 1. åˆ›å»ºç»Ÿä¸€çš„ç¯å¢ƒå˜é‡åŠ è½½å™¨ (`src/utils/env-loader.ts`)

- **å‚è€ƒ `create.js` çš„ç¯å¢ƒå˜é‡åŠ è½½æ¨¡å¼**
- ç»Ÿä¸€å¤„ç†æ‰€æœ‰ç¯å¢ƒå˜é‡
- æä¾›è¯¦ç»†çš„åŠ è½½çŠ¶æ€æ—¥å¿—
- æ”¯æŒç¯å¢ƒå˜é‡éªŒè¯
- è‡ªåŠ¨åˆå§‹åŒ–æœºåˆ¶

**ä¸»è¦åŠŸèƒ½ï¼š**
- è‡ªåŠ¨åŠ è½½ `.env.local` æ–‡ä»¶
- åˆå¹¶ç³»ç»Ÿç¯å¢ƒå˜é‡å’Œæœ¬åœ°ç¯å¢ƒå˜é‡
- æä¾›è¯¦ç»†çš„ç¯å¢ƒå˜é‡çŠ¶æ€æ—¥å¿—
- éªŒè¯å¿…éœ€çš„ç¯å¢ƒå˜é‡
- æ”¯æŒè‡ªå®šä¹‰ç¯å¢ƒå˜é‡æ–‡ä»¶è·¯å¾„

### 2. æ›´æ–° `scripts/fetch-hn.ts`

**ç¯å¢ƒå˜é‡å¤„ç†ï¼š**
- ä½¿ç”¨æ–°çš„ `EnvLoader` æ›¿ä»£åŸæœ‰çš„ç¯å¢ƒå˜é‡åŠ è½½é€»è¾‘
- ç®€åŒ–äº†ç¯å¢ƒå˜é‡åˆå§‹åŒ–ä»£ç 

**è¿›åº¦ä¿¡æ¯æ”¹è¿›ï¼š**
- æ·»åŠ äº†è¯¦ç»†çš„è¿›åº¦ç»Ÿè®¡ï¼ˆæˆåŠŸã€è·³è¿‡ã€é”™è¯¯è®¡æ•°ï¼‰
- ä½¿ç”¨è¡¨æƒ…ç¬¦å·å¢å¼ºæ—¥å¿—å¯è¯»æ€§
- æ·»åŠ äº†å¤„ç†æ—¶é—´ç»Ÿè®¡
- æ”¹è¿›äº†é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

**ä¸»è¦æ”¹è¿›ï¼š**
```typescript
// ä¹‹å‰
console.log('Starting HackerNews data fetch and analysis...');

// ç°åœ¨
console.log('ğŸš€ å¼€å§‹ HackerNews æ•°æ®è·å–å’Œåˆ†æ...');
console.log('ğŸ“Š å¤„ç†ç»Ÿè®¡:');
console.log(`   âœ… æˆåŠŸå¤„ç†: ${processedCount} ä¸ªæ•…äº‹`);
console.log(`   â­ï¸  è·³è¿‡: ${skippedCount} ä¸ªæ•…äº‹`);
console.log(`   âŒ é”™è¯¯: ${errorCount} ä¸ªæ•…äº‹`);
console.log(`   â±ï¸  æ€»è€—æ—¶: ${duration} ç§’`);
```

### 3. æ›´æ–° `src/utils/claude-analyzer.ts`

**Hooks å’Œä¼šè¯ç®¡ç†ï¼š**
- æ·»åŠ äº†å®Œæ•´çš„ hooks ç³»ç»Ÿï¼Œå‚è€ƒ `create.js` çš„æ¨¡å¼
- å®ç°äº† `SessionStart`ã€`PreToolUse`ã€`PostToolUse`ã€`SessionEnd` hooks
- æ·»åŠ äº†æµå¼æ¶ˆæ¯å¤„ç†
- æ”¹è¿›äº†ä¼šè¯çŠ¶æ€ç›‘æ§

**è¿›åº¦ä¿¡æ¯å¤„ç†ï¼š**
- è¯¦ç»†çš„ Claude æŸ¥è¯¢è¿›åº¦æ—¥å¿—
- ä¼šè¯ä¿¡æ¯ç»Ÿè®¡ï¼ˆè€—æ—¶ã€èŠ±è´¹ã€è½®æ¬¡ï¼‰
- åˆ†æç»“æœæ‘˜è¦ç»Ÿè®¡
- æ”¹è¿›çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

**ç¯å¢ƒå˜é‡é›†æˆï¼š**
- ä½¿ç”¨ `EnvLoader` ç»Ÿä¸€ç®¡ç†ç¯å¢ƒå˜é‡
- ç®€åŒ–äº†ç¯å¢ƒå˜é‡éªŒè¯é€»è¾‘
- æ”¹è¿›äº†é…ç½®ç®¡ç†

**ä¸»è¦æ”¹è¿›ï¼š**
```typescript
// æ·»åŠ äº†å®Œæ•´çš„ hooks ç³»ç»Ÿ
hooks: {
  SessionStart: [{
    hooks: [async(input) => {
      console.log('ğŸš€ Claude ä¼šè¯å¼€å§‹ï¼ŒID:', input.session_id);
      return { continue: true };
    }]
  }],
  PreToolUse: [{
    hooks: [async(input: any) => {
      console.log(`ğŸ› ï¸  å³å°†è°ƒç”¨å·¥å…·: ${input.tool_name || 'æœªçŸ¥å·¥å…·'}`);
      return { continue: true };
    }]
  }],
  // ... å…¶ä»– hooks
}

// æ·»åŠ äº†æµå¼æ¶ˆæ¯å¤„ç†
for await (const message of queryResult) {
  switch (message.type) {
    case 'system':
      if (message.subtype === 'init') {
        console.log('âœ… Claude ä¼šè¯å·²å¯åŠ¨ï¼Œæ¨¡å‹:', message.model);
      }
      break;
    case 'result':
      if (message.subtype === 'success') {
        console.log('\nâœ… Claude ä»»åŠ¡å®Œæˆï¼');
        console.log('â±ï¸  è€—æ—¶:', message.duration_ms, 'ms');
        console.log('ğŸ’° èŠ±è´¹: $', message.total_cost_usd.toFixed(6));
        console.log('ğŸ“Š æ€»è½®æ¬¡:', message.num_turns);
      }
      break;
  }
}
```

## æŠ€æœ¯æ”¹è¿›

### 1. ç±»å‹å®‰å…¨
- ä¿®å¤äº† TypeScript ç±»å‹é”™è¯¯
- ä½¿ç”¨ `any` ç±»å‹å¤„ç† hooks è¾“å…¥å‚æ•°
- æ”¹è¿›äº†ç±»å‹å®šä¹‰

### 2. é”™è¯¯å¤„ç†
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æ¨¡å¼
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•
- ä¼˜é›…çš„é™çº§å¤„ç†

### 3. æ—¥å¿—ç³»ç»Ÿ
- ä½¿ç”¨è¡¨æƒ…ç¬¦å·å¢å¼ºå¯è¯»æ€§
- ç»“æ„åŒ–çš„æ—¥å¿—è¾“å‡º
- è¯¦ç»†çš„è¿›åº¦è·Ÿè¸ª

### 4. é…ç½®ç®¡ç†
- ç»Ÿä¸€çš„ç¯å¢ƒå˜é‡ç®¡ç†
- çµæ´»çš„é…ç½®é€‰é¡¹
- è‡ªåŠ¨éªŒè¯æœºåˆ¶

## ä½¿ç”¨æ–¹å¼

### ç¯å¢ƒå˜é‡è®¾ç½®
ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env.local` æ–‡ä»¶ï¼š
```bash
ANTHROPIC_AUTH_TOKEN=your_token_here
ANTHROPIC_BASE_URL=your_base_url_here
ANTHROPIC_MODEL=claude-3-5-sonnet-20241022
```

### è¿è¡Œè„šæœ¬
```bash
# ä½¿ç”¨ TypeScript ç‰ˆæœ¬
npm run fetch-ts

# æˆ–ç›´æ¥è¿è¡Œ
npx tsx scripts/fetch-hn.ts
```

## é¢„æœŸæ•ˆæœ

1. **æ›´å¥½çš„å¯è§‚æµ‹æ€§**ï¼šè¯¦ç»†çš„è¿›åº¦æ—¥å¿—å’Œä¼šè¯ä¿¡æ¯
2. **ç»Ÿä¸€çš„é…ç½®ç®¡ç†**ï¼šæ‰€æœ‰ç¯å¢ƒå˜é‡é€šè¿‡ `EnvLoader` ç»Ÿä¸€ç®¡ç†
3. **æ”¹è¿›çš„é”™è¯¯å¤„ç†**ï¼šæ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œä¼˜é›…çš„é™çº§
4. **æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ**ï¼šæ¸…æ™°çš„è¿›åº¦æŒ‡ç¤ºå’ŒçŠ¶æ€åé¦ˆ

## å…¼å®¹æ€§

- ä¿æŒäº†ä¸ç°æœ‰ä»£ç çš„å®Œå…¨å…¼å®¹æ€§
- æ‰€æœ‰ç°æœ‰åŠŸèƒ½ç»§ç»­æ­£å¸¸å·¥ä½œ
- æ·»åŠ çš„åŠŸèƒ½éƒ½æ˜¯å¯é€‰çš„å¢å¼ºåŠŸèƒ½

è¿™äº›æ›´æ”¹ç¡®ä¿äº†é¡¹ç›®ä¸­çš„ claude-agent-sdk ä½¿ç”¨æ–¹å¼ä¸ `create.js` æ–‡ä»¶ä¿æŒä¸€è‡´ï¼Œæä¾›äº†æ›´å¥½çš„å¼€å‘ä½“éªŒå’Œè¿è¡Œæ—¶çš„å¯è§‚æµ‹æ€§ã€‚
